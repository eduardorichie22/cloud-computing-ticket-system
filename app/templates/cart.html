<!DOCTYPE html>
<html lang="en">
<head>
    <title>My Cart</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { theme: { extend: { colors: { plPurple: '#37003c', plGreen: '#00ff85' } } } }</script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 font-sans min-h-screen">

    <nav class="bg-white p-4 shadow-sm">
        <div class="container mx-auto flex justify-between items-center">
            <a href="/" class="text-plPurple font-bold flex items-center gap-2">
                <i class="fa-solid fa-arrow-left"></i> Continue Shopping
            </a>
            <div class="font-bold text-lg">MY CART</div>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-8 max-w-3xl">
        {% if cart_items %}
            <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-6">
                <div class="bg-plPurple text-white p-4 text-sm font-bold flex justify-between">
                    <span>ITEM</span>
                    <span>PRICE</span>
                </div>

                {% for item in cart_items %}
                <div class="p-6 border-b border-gray-100 flex items-center justify-between group hover:bg-gray-50 transition">
                    <div class="flex items-center gap-4">
                        <div class="h-10 w-10 bg-gray-100 rounded-full flex items-center justify-center text-plPurple">
                            <i class="fa-solid fa-ticket"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg group-hover:text-plPurple transition">{{ item.match.home_team }} vs {{ item.match.away_team }}</h3>
                            <p class="text-gray-500 text-sm"><i class="fa-solid fa-location-dot mr-1"></i>{{ item.match.stadium }}</p>
                        </div>
                    </div>
                    <div class="font-bold text-xl text-gray-800">£{{ item.match.price }}</div>
                </div>
                {% endfor %}
                
                <div class="p-6 bg-gray-50 flex justify-between items-center border-t border-gray-200">
                    <span class="text-gray-500 font-bold uppercase text-xs tracking-wider">Total Amount</span>
                    <span class="text-4xl font-black text-plPurple">£{{ total }}</span>
                </div>
            </div>

            <button onclick="instantCheckout()" id="btnCheckout" 
                class="w-full bg-plGreen text-plPurple font-bold py-4 rounded-xl text-xl hover:bg-green-400 shadow-lg transition transform active:scale-[0.99] flex items-center justify-center gap-3">
                <span>SECURE CHECKOUT</span> <i class="fa-solid fa-lock"></i>
            </button>
        {% else %}
            <div class="text-center py-20">
                <div class="bg-white h-32 w-32 rounded-full flex items-center justify-center mx-auto mb-6 shadow-sm">
                    <i class="fa-solid fa-cart-shopping text-5xl text-gray-300"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Your cart is empty</h2>
                <p class="text-gray-500 mb-6">Looks like you haven't added any tickets yet.</p>
                <a href="/" class="inline-block bg-plPurple text-white px-8 py-3 rounded-lg font-bold hover:bg-purple-900 transition">Browse Matches</a>
            </div>
        {% endif %}
    </div>

    <script>
        // LOGIC "FORMALITAS" - LANGSUNG PINDAH HALAMAN
        async function instantCheckout() {
            const btn = document.getElementById('btnCheckout');
            
            // Ubah tampilan tombol biar user tau lagi proses
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Processing...';
            btn.classList.add('opacity-75', 'cursor-not-allowed');
            btn.disabled = true;

            try {
                // Tembak API Backend
                const res = await fetch('/checkout', { method: 'POST' });
                
                // Cek status response
                if (res.ok) {
                    // SUKSES! Langsung lempar ke tiket saya
                    window.location.href = '/my-tickets';
                } else {
                    // Kalau error, baca pesan errornya
                    const data = await res.json(); 
                    alert('Checkout Failed: ' + (data.detail || 'Unknown Error'));
                    location.reload(); // Refresh aja biar aman
                }
            } catch (e) {
                console.error(e);
                alert('Connection Error! Check your internet or server.');
                btn.innerHTML = 'TRY AGAIN';
                btn.disabled = false;
                btn.classList.remove('opacity-75', 'cursor-not-allowed');
            }
        }
    </script>
</body>
</html>